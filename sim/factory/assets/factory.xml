<?xml version="1.0" encoding="utf-8"?>
<!--
Factory Environment for Cosmos-Predict2.5 World Model Demo

This MuJoCo scene defines a minimal factory floor with:
- A mobile robot base that can navigate
- Workstations where tasks are performed
- Conveyor-like regions
- Storage areas with boxes

The robot can be augmented with an arm for manipulation tasks.
-->
<mujoco model="factory">
  <compiler angle="radian" autolimits="true"/>

  <option timestep="0.01" gravity="0 0 -9.81" integrator="implicitfast"/>

  <default>
    <default class="robot">
      <geom rgba="0.3 0.5 0.8 1" friction="1.0 0.005 0.0001"/>
      <joint damping="0.5"/>
    </default>
    <default class="floor">
      <geom rgba="0.4 0.4 0.4 1" friction="1.0 0.005 0.0001"/>
    </default>
    <default class="workstation">
      <geom rgba="0.6 0.6 0.2 1"/>
    </default>
    <default class="storage">
      <geom rgba="0.5 0.3 0.2 1"/>
    </default>
    <default class="box">
      <geom rgba="0.8 0.4 0.2 1" mass="0.5"/>
    </default>
    <default class="goal">
      <geom rgba="0.2 0.8 0.3 0.5"/>
    </default>
  </default>

  <asset>
    <!-- Checkered floor texture for visual reference -->
    <texture name="floor_tex" type="2d" builtin="checker" rgb1="0.35 0.35 0.35" rgb2="0.45 0.45 0.45" width="512" height="512"/>
    <material name="floor_mat" texture="floor_tex" texrepeat="10 10" reflectance="0.1"/>

    <!-- Metal texture for workstations -->
    <texture name="metal_tex" type="2d" builtin="flat" rgb1="0.6 0.6 0.65" width="64" height="64"/>
    <material name="metal_mat" texture="metal_tex" reflectance="0.3" shininess="0.5"/>

    <!-- Wood texture for boxes -->
    <texture name="wood_tex" type="2d" builtin="flat" rgb1="0.6 0.4 0.25" width="64" height="64"/>
    <material name="wood_mat" texture="wood_tex"/>
  </asset>

  <worldbody>
    <!-- Lighting -->
    <light name="overhead" pos="0 0 4" dir="0 0 -1" diffuse="0.8 0.8 0.8" specular="0.3 0.3 0.3" directional="true"/>
    <light name="fill" pos="2 2 3" dir="-0.5 -0.5 -1" diffuse="0.4 0.4 0.4" directional="true"/>

    <!-- Factory Floor (4m x 4m) -->
    <geom name="floor" type="plane" size="2 2 0.1" material="floor_mat" class="floor"/>

    <!-- Walls (boundaries) -->
    <geom name="wall_north" type="box" pos="0 2 0.25" size="2 0.05 0.25" rgba="0.5 0.5 0.5 1"/>
    <geom name="wall_south" type="box" pos="0 -2 0.25" size="2 0.05 0.25" rgba="0.5 0.5 0.5 1"/>
    <geom name="wall_east" type="box" pos="2 0 0.25" size="0.05 2 0.25" rgba="0.5 0.5 0.5 1"/>
    <geom name="wall_west" type="box" pos="-2 0 0.25" size="0.05 2 0.25" rgba="0.5 0.5 0.5 1"/>

    <!-- Workstation 1: Assembly area (top-left) -->
    <body name="workstation1" pos="-1.2 1.2 0">
      <geom name="ws1_table" type="box" pos="0 0 0.35" size="0.4 0.3 0.35" material="metal_mat" class="workstation"/>
      <geom name="ws1_top" type="box" pos="0 0 0.72" size="0.45 0.35 0.02" material="metal_mat"/>
      <!-- Tools/items on workstation -->
      <geom name="ws1_item1" type="cylinder" pos="0.15 0.1 0.78" size="0.05 0.04" rgba="0.8 0.2 0.2 1"/>
      <geom name="ws1_item2" type="box" pos="-0.15 -0.05 0.78" size="0.06 0.06 0.04" rgba="0.2 0.2 0.8 1"/>
    </body>

    <!-- Workstation 2: Inspection area (top-right) -->
    <body name="workstation2" pos="1.2 1.2 0">
      <geom name="ws2_table" type="box" pos="0 0 0.35" size="0.35 0.35 0.35" material="metal_mat" class="workstation"/>
      <geom name="ws2_top" type="box" pos="0 0 0.72" size="0.4 0.4 0.02" material="metal_mat"/>
      <!-- Inspection equipment -->
      <geom name="ws2_scanner" type="box" pos="0 0 0.85" size="0.15 0.15 0.1" rgba="0.1 0.1 0.1 1"/>
    </body>

    <!-- Storage Area: Shelving unit (bottom-left) -->
    <body name="storage" pos="-1.3 -1.2 0">
      <!-- Shelf frame -->
      <geom name="shelf_left" type="box" pos="-0.35 0 0.4" size="0.03 0.25 0.4" class="storage"/>
      <geom name="shelf_right" type="box" pos="0.35 0 0.4" size="0.03 0.25 0.4" class="storage"/>
      <geom name="shelf_back" type="box" pos="0 0.22 0.4" size="0.35 0.03 0.4" class="storage"/>
      <geom name="shelf_bottom" type="box" pos="0 0 0.15" size="0.32 0.22 0.02" class="storage"/>
      <geom name="shelf_middle" type="box" pos="0 0 0.4" size="0.32 0.22 0.02" class="storage"/>
      <geom name="shelf_top" type="box" pos="0 0 0.65" size="0.32 0.22 0.02" class="storage"/>
    </body>

    <!-- Movable boxes in storage -->
    <body name="box1" pos="-1.3 -1.1 0.22">
      <freejoint name="box1_joint"/>
      <geom name="box1_geom" type="box" size="0.08 0.08 0.06" material="wood_mat" class="box"/>
    </body>

    <body name="box2" pos="-1.15 -1.1 0.22">
      <freejoint name="box2_joint"/>
      <geom name="box2_geom" type="box" size="0.07 0.07 0.05" rgba="0.3 0.5 0.7 1" class="box"/>
    </body>

    <body name="box3" pos="-1.3 -1.1 0.47">
      <freejoint name="box3_joint"/>
      <geom name="box3_geom" type="box" size="0.06 0.06 0.05" rgba="0.7 0.3 0.5 1" class="box"/>
    </body>

    <!-- Delivery/Drop-off zone (bottom-right) -->
    <body name="delivery_zone" pos="1.2 -1.2 0">
      <!-- Floor marking -->
      <geom name="dz_marker" type="box" pos="0 0 0.005" size="0.5 0.5 0.005" rgba="0.2 0.6 0.2 0.3"/>
      <!-- Pallet -->
      <geom name="pallet" type="box" pos="0 0 0.04" size="0.4 0.4 0.04" rgba="0.6 0.5 0.3 1"/>
    </body>

    <!-- Goal marker (dynamic, can be repositioned) -->
    <body name="goal_marker" pos="0 0 0">
      <geom name="goal_geom" type="cylinder" pos="0 0 0.01" size="0.15 0.01" class="goal"/>
      <geom name="goal_center" type="sphere" pos="0 0 0.03" size="0.03" rgba="0.1 0.9 0.2 0.8"/>
    </body>

    <!-- ============== MOBILE ROBOT ============== -->
    <body name="robot_base" pos="0 0 0.08">
      <!-- Main chassis -->
      <joint name="robot_x" type="slide" axis="1 0 0" range="-1.8 1.8"/>
      <joint name="robot_y" type="slide" axis="0 1 0" range="-1.8 1.8"/>
      <joint name="robot_yaw" type="hinge" axis="0 0 1" range="-3.14159 3.14159"/>

      <geom name="chassis" type="cylinder" size="0.15 0.05" class="robot"/>
      <geom name="chassis_top" type="cylinder" pos="0 0 0.06" size="0.12 0.02" rgba="0.2 0.4 0.7 1"/>

      <!-- Direction indicator (front) -->
      <geom name="front_marker" type="box" pos="0.12 0 0.02" size="0.04 0.02 0.02" rgba="0.9 0.3 0.1 1"/>

      <!-- Wheels (visual only - kinematics handled by joints) -->
      <geom name="wheel_left" type="cylinder" pos="0 0.12 -0.03" size="0.05 0.02" euler="1.5708 0 0" rgba="0.2 0.2 0.2 1"/>
      <geom name="wheel_right" type="cylinder" pos="0 -0.12 -0.03" size="0.05 0.02" euler="1.5708 0 0" rgba="0.2 0.2 0.2 1"/>
      <geom name="caster" type="sphere" pos="-0.1 0 -0.04" size="0.03" rgba="0.3 0.3 0.3 1"/>

      <!-- Robot arm mount point -->
      <body name="arm_base" pos="0 0 0.08">
        <geom name="arm_mount" type="cylinder" size="0.04 0.02" rgba="0.4 0.4 0.4 1"/>

        <!-- Simple 2-DOF arm for demonstration -->
        <body name="arm_link1" pos="0 0 0.02">
          <joint name="arm_shoulder" type="hinge" axis="0 1 0" range="-1.57 1.57" damping="1.0"/>
          <geom name="link1" type="capsule" fromto="0 0 0 0 0 0.2" size="0.025" rgba="0.5 0.5 0.6 1"/>

          <body name="arm_link2" pos="0 0 0.2">
            <joint name="arm_elbow" type="hinge" axis="0 1 0" range="-2.0 2.0" damping="1.0"/>
            <geom name="link2" type="capsule" fromto="0 0 0 0 0 0.15" size="0.02" rgba="0.5 0.5 0.6 1"/>

            <!-- Simple gripper -->
            <body name="gripper" pos="0 0 0.15">
              <joint name="gripper_joint" type="slide" axis="0 1 0" range="0 0.04" damping="0.5"/>
              <geom name="gripper_base" type="box" size="0.03 0.02 0.015" rgba="0.3 0.3 0.3 1"/>
              <geom name="gripper_left" type="box" pos="0 0.025 0.02" size="0.01 0.005 0.02" rgba="0.4 0.4 0.4 1"/>
              <geom name="gripper_right" type="box" pos="0 -0.025 0.02" size="0.01 0.005 0.02" rgba="0.4 0.4 0.4 1"/>
            </body>
          </body>
        </body>
      </body>
    </body>
  </worldbody>

  <actuator>
    <!-- Mobile base actuation (velocity control) -->
    <velocity name="base_x" joint="robot_x" kv="50" forcerange="-20 20"/>
    <velocity name="base_y" joint="robot_y" kv="50" forcerange="-20 20"/>
    <velocity name="base_yaw" joint="robot_yaw" kv="10" forcerange="-5 5"/>

    <!-- Arm actuation (position control) -->
    <position name="shoulder" joint="arm_shoulder" kp="50" forcerange="-10 10"/>
    <position name="elbow" joint="arm_elbow" kp="50" forcerange="-10 10"/>
    <position name="gripper" joint="gripper_joint" kp="20" forcerange="-5 5"/>
  </actuator>

  <sensor>
    <!-- Robot pose sensors -->
    <framepos name="robot_pos" objtype="body" objname="robot_base"/>
    <framequat name="robot_quat" objtype="body" objname="robot_base"/>
    <framelinvel name="robot_vel" objtype="body" objname="robot_base"/>

    <!-- Arm joint sensors -->
    <jointpos name="shoulder_pos" joint="arm_shoulder"/>
    <jointpos name="elbow_pos" joint="arm_elbow"/>
    <jointpos name="gripper_pos" joint="gripper_joint"/>

    <!-- End effector position -->
    <framepos name="ee_pos" objtype="body" objname="gripper"/>
  </sensor>
</mujoco>
